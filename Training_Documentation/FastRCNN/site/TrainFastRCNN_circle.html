<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>Training FastRCNN_circle - User Documentations FastRCNN FG VT</title>
        <link href="css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="js/jquery-1.10.2.min.js" defer></script>
        <script src="js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html">User Documentations FastRCNN FG VT</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="index.html">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li class="active">
    <a href="TrainFastRCNN_circle.html">Training FastRCNN_circle</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="index.html">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="disabled">
                                <a rel="prev" >
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#training-documentation-of-fastrcnn_circle">Training documentation of FastRCNN_circle</a></li>
            <li><a href="#1-sort-you-picture">1. Sort you picture</a></li>
            <li><a href="#2-convert-imagej-annotations-roi-to-bb-circle-xmls">2. Convert ImageJ-Annotations (ROI) to BB-Circle-XMLs</a></li>
            <li><a href="#3-check-if-all-annotations-are-correct">3. Check if all annotations are correct</a></li>
            <li><a href="#4-create-voc-training-data-struct-from-annos-bb">4. Create VOC training data struct from annos BB</a></li>
            <li><a href="#5-create-symlink-softlink">5. Create Symlink / Softlink</a></li>
            <li><a href="#6-start-the-training">6. Start the training</a></li>
        <li class="main "><a href="#more-tipps">More Tipps</a></li>
            <li><a href="#to-detect-big-particles">To detect 'big' Particles</a></li>
            <li><a href="#delete-voc-folder">Delete VOC-Folder</a></li>
            <li><a href="#perform-net-training">Perform Net-Training</a></li>
            <li><a href="#finetuning">FineTuning</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="training-documentation-of-fastrcnn_circle">Training documentation of FastRCNN_circle</h1>
<h2 id="1-sort-you-picture">1. Sort you picture</h2>
<h2 id="2-convert-imagej-annotations-roi-to-bb-circle-xmls">2. Convert ImageJ-Annotations (ROI) to BB-Circle-XMLs</h2>
<ol>
<li>Open convert_imageJ_annos_to_BB_cirle_defs.m</li>
<li>Change following variables:<ul>
<li>Input dir</li>
<li>output dir</li>
<li>Image type = 'bmp' # should set 'bmp' for SOPAT pictures</li>
<li>class names: 'B, T' # 'Blasen' and 'Tropfen'</li>
</ul>
</li>
<li>Also check Fiji/ImageJ version - path name</li>
</ol>
<h2 id="3-check-if-all-annotations-are-correct">3. Check if all annotations are correct</h2>
<ol>
<li>Open gui_check_circle_annos.m</li>
</ol>
<h2 id="4-create-voc-training-data-struct-from-annos-bb">4. Create VOC training data struct from annos BB</h2>
<ol>
<li>Open Visual Studio</li>
<li>Open project --&gt; create VOC training data struct from annos BB</li>
<li>Right click on Python Environment -&gt; Add/Remove Python Environment</li>
<li>Choose Miniconda2</li>
<li>Click on Py.Data</li>
<li>Change following variables:<ul>
<li>annoDir</li>
<li>resultDir</li>
<li>scales</li>
<li>fractionOf</li>
<li>if necessary other variables under user options (From trainval.txt to test.txt, sort representative and all kind of images)</li>
</ul>
</li>
<li>Click run</li>
</ol>
<h2 id="5-create-symlink-softlink">5. Create Symlink / Softlink</h2>
<h3 id="manually">Manually</h3>
<ol>
<li>Create DNNs/dev/.../data</li>
<li>Create VOCdevkit0020_folder name "imdbSubSetNames"</li>
<li>Create Subfolder "results\VOC0020\Main"</li>
<li>Open cmd as administrator --&gt; <code>cd</code> to target folder</li>
<li>Run <code>mklink /d VOC0020 source_path_name</code></li>
</ol>
<h3 id="batch-mode">Batch mode</h3>
<ol>
<li>Open python_tools</li>
<li>Run <code>conda environment list</code> - check if <code>py36</code> is available</li>
<li>Run <code>activate py36</code></li>
<li>Open C:\DNNs\dev\DNNs_python_tools\inputDataFromVocFolders.py</li>
<li>change <code>rootVOCFolder</code> and <code>fasterRCNNDataFolder</code></li>
<li>Run <code>python inputDataFromVocFolders.py</code> in cmd</li>
</ol>
<h2 id="6-start-the-training">6. Start the training</h2>
<ol>
<li>Open Visual Studio --&gt; perform_net_training.sln</li>
<li>Open project --&gt; create VOC training data struct from annos BB</li>
<li>Right click on Python Environment -&gt; Add/Remove Python Environment</li>
<li>Choose Miniconda2</li>
<li>Click on Py.Data --&gt; perform_net_training.py</li>
<li>Important things to configure:<ul>
<li>showScores = False / # True</li>
<li>In the solver.prototxt -- to change:<ul>
<li>base_lr</li>
<li>gamma</li>
<li>stepsize</li>
</ul>
</li>
<li>Initial Weight using orig.caffemodel</li>
<li>Move or delete Old Voc data from output folder</li>
<li>YML-Data for configuration</li>
<li>PerformTesting on test (also possible with trainval)</li>
<li>Change <code>imdbSubSetNames</code> to folder name after "VOC0020_"</li>
</ul>
</li>
<li>Edit YML Data, you can find it by copying path from python file. Configure following important variables:<ul>
<li>Scales: Aufloesung</li>
<li>Region Proposal Net</li>
<li>RPN_PRE_ hochschrauben</li>
<li>PIXEL_MEAN: [55, 55, 55]</li>
<li>CONF_THRESH: 0.8</li>
</ul>
</li>
<li>Configure Config.py</li>
<li>Click run</li>
</ol>
<h1 id="more-tipps">More Tipps</h1>
<h2 id="to-detect-big-particles">To detect 'big' Particles</h2>
<ol>
<li>Set down the <code>CONF_THRESH</code> in YML data</li>
<li>Do more annotations with 'big' droplets/bubbles</li>
<li>Scale down the picture</li>
</ol>
<h2 id="delete-voc-folder">Delete VOC-Folder</h2>
<p>Always delete VOC-Folders or move them to output.</p>
<h2 id="perform-net-training">Perform Net-Training</h2>
<ul>
<li>Set up YML RPN_PRE_NMS_TOP_N &amp; RPN_POST_NMS_TOP_N as high as possible (only change it in Test)</li>
<li>in Testblock: CONF_THRESH: 0.5</li>
<li>Scale the picture (zusammen mit PRE &amp; POST)</li>
</ul>
<h2 id="finetuning">FineTuning</h2>
<ul>
<li>Change <code>stepsize</code> to 10.000</li>
<li>Do not change base_lr: 0.00005</li>
<li>nur mit den Gasblasenbildern</li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js" defer></script>
        <script src="search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
